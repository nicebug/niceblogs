<h2>web.py学习笔记</h2>
<p>由于后台的几个需求，需要给测试同学构造gm指令以方便测试，思来想去还是搭建个快速的webserver来方便测试同学，django太庞大，tornado不大熟悉，别人介绍了下<a href="http://webpy.org/">web.py</a>，而且也不需要安装一大堆的第三方依赖库(原谅楼主有时候在服务器上不喜欢装第三方库的臭毛病吧)，甚至把web.py打包后都不需要额外安装任何东西。简单看了下web.py的文档，感觉还是入手还是比较容易。</p>
<p>工程文档目录结构：
main
|---- conf (工程配置文件)
|---- static (js，图片等)
|---- template (html文件)
|---- web (web.py的库文件)
|---- config.py (目录，密码等配置)
|---- index.py (路由文件)</p>
<p>接着就可以开始coding，在web.py中需要指定url路由,当url请求中包含相应关键字时则跳转到相应的class中进行处理。</p>
<pre class="code literal-block"><span class="n">urls</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;/favicon.ico&#39;</span><span class="p">,</span><span class="s">&quot;Ico&quot;</span><span class="p">,</span>
    <span class="s">&#39;/about&#39;</span><span class="p">,</span> <span class="s">&quot;About&quot;</span><span class="p">,</span>
    <span class="s">&#39;/list_(.*)&#39;</span><span class="p">,</span> <span class="s">&quot;Script&quot;</span><span class="p">,</span>
    <span class="s">&#39;/bin_upload(.*)&#39;</span><span class="p">,</span> <span class="s">&quot;Upload&quot;</span><span class="p">,</span>
    <span class="s">&#39;/changetime(.*)&#39;</span><span class="p">,</span> <span class="s">&quot;ChangeTime&quot;</span><span class="p">,</span>
    <span class="s">&#39;/(.*)&#39;</span><span class="p">,</span><span class="s">&#39;Index&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">render</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;template/&#39;</span><span class="p">)</span>
</pre>


<p>以下以about跳转为例：</p>
<pre class="code literal-block"><span class="k">class</span> <span class="nc">Upload</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c"># save a file to disk</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="p">{})</span>
        <span class="c">#print &quot;bintag, filename:&quot;, x.bintag, x.file.filename</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">bintag</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&lt;script type=</span><span class="se">\&quot;</span><span class="s">text/javascript</span><span class="se">\&quot;</span><span class="s">&gt;alert(</span><span class="se">\&quot;</span><span class="s">参数输入不正确，请检查参数!</span><span class="se">\&quot;</span><span class="s">); </span><span class="se">\</span>
<span class="s">                parent.location.href= parent.location.href;&lt;/script&gt;&quot;</span>
</pre>


<p><strong>list_resconv.html</strong></p>
<pre class="code literal-block"> <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;upload&quot;</span> <span class="na">action=</span><span class="s">&quot;bin_upload&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span> <span class="na">enctype=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">target=</span><span class="s">&quot;ifm&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;fieldset&gt;</span>
                        <span class="nt">&lt;legend&gt;</span>bin上传路径:<span class="nt">&lt;/legend&gt;</span>

                        <span class="nt">&lt;div&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;tag&quot;</span> <span class="na">class=</span><span class="s">&quot;col-sm-2 control-label&quot;</span><span class="nt">&gt;</span>bin档目录名:<span class="nt">&lt;/label&gt;</span>
                                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;bintag&quot;</span> <span class="na">name=</span><span class="s">&quot;bintag&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>  
                                <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span> <span class="na">class=</span><span class="s">&quot;col-sm-2 control-label&quot;</span><span class="nt">&gt;</span>bin文件:<span class="nt">&lt;/label&gt;</span>
                                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;file&quot;</span> <span class="na">id=</span><span class="s">&quot;fileselect&quot;</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">title=</span><span class="s">&quot;choose a file&quot;</span> <span class="na">onchange=</span><span class="s">&quot;this.form.submit();&quot;</span><span class="nt">&gt;</span>
                                <span class="c">&lt;!--&lt;p class=&quot;help-block&quot;&gt;要上传的bin文件.&lt;/p&gt;--&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>

                            <span class="c">&lt;!--&lt;div id=&quot;filedrag&quot;&gt;or drop the file here&lt;/div&gt;--&gt;</span>

                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/fieldset&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre>


<p>当POST请求跳转到bin_upload时，则跳转到Upload进行相应的处理，Upload中处理接收的参数，进行后台逻辑处理。如果需要将处理后的数据返回前台，通常使用render来处理返回的数据<code>render.htmlfilename(parms)</code>的方式。</p>